<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pendaftaran Santri 2026 - Ponpes Miftahul Ulum</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #075E54; --secondary: #25D366; --bg: #f4f7f6; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); margin: 0; }
        .header-container { background-color: #d1d5db; text-align: center; }
        .header-image { max-width: 1000px; width: 100%; height: auto; display: block; margin: 0 auto; }
        .container { max-width: 700px; margin: 20px auto 40px; padding: 30px; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        label { font-weight: 600; display: block; margin-top: 15px; font-size: 0.85em; }
        input, select, textarea { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .button-group { display: flex; gap: 10px; margin-top: 25px; }
        button { flex: 2; background: var(--secondary); color: white; border: none; padding: 15px; border-radius: 8px; font-weight: 700; cursor: pointer; }
        .btn-cancel { flex: 1; background: #95a5a6; }
        #preview-container { margin-top: 10px; display: none; text-align: center; border: 1px dashed #ccc; padding: 10px; }
        #image-preview { max-height: 200px; border-radius: 5px; }
        @media (max-width: 600px) { .grid-2, .button-group { grid-template-columns: 1fr; flex-direction: column; } }
    </style>
</head>
<body>

<div class="header-container">
    <img src="header-mu.png" class="header-image">
</div>

<div class="container">
    <h3 style="text-align:center; color:var(--primary);">Formulir Santri 2026</h3>
    <form id="pendaftaranForm">
        <label>Nama Lengkap Calon Santri :</label>
        <input type="text" id="nama" placeholder="Sesuai Ijazah" required>

        <label>Jenis Kelamin :</label>
        <select id="jk" required>
            <option value="">-- Pilih --</option>
            <option value="Laki-laki">Laki-laki</option>
            <option value="Perempuan">Perempuan</option>
        </select>

        <div class="grid-2">
            <div>
                <label>NISN :</label>
                <input type="number" id="nisn" placeholder="10 Digit NISN" required>
            </div>
            <div>
                <label>NIK :</label>
                <input type="number" id="nik" placeholder="16 Digit NIK" required>
            </div>
        </div>

        <label>Nomor Kartu Keluarga :</label>
        <input type="number" id="no_kk" placeholder="16 Digit Nomor KK" required>

        <div class="grid-2">
            <div>
                <label>Tempat Lahir :</label>
                <input type="text" id="tempat" placeholder="Sesuai Akta Lahir/Ijazah" required>
            </div>
            <div>
                <label>Tanggal Lahir :</label>
                <input type="date" id="tgl" required>
            </div>
        </div>

        <label>Nama Sekolah Asal (SD/MI, SMP/MTs) :</label>
        <input type="text" id="sekolah" placeholder="Nama SD/MI SMP/MTs Sebelumnya" required>

        <label>Alamat Lengkap (RT/RW Desa, Kec, Kab, Kode Pos) :</label>
        <textarea id="alamat" rows="3" required></textarea>

        <label>Nama Ibu Kandung :</label>
        <input type="text" id="ibu" placeholder="Sesuai Akta Lahir" required>

        <label>Nomor HP Orang Tua/Wali :</label>
        <input type="number" id="hp" placeholder="Contoh: 08123xxx" required>

        <label>Upload Foto Calon Santri :</label>
        <input type="file" id="foto" accept="image/*" onchange="previewImage()" required>
        <div id="preview-container"><img id="image-preview"></div>

        <div class="button-group">
            <button type="button" class="btn-cancel" onclick="resetForm()">BATAL</button>
            <button type="button" id="btnSubmit" onclick="kirimData()">Daftar via WhatsApp</button>
        </div>
    </form>
</div>

<script>
    const URL_SCRIPT_GOOGLE = "https://script.google.com/macros/s/AKfycbz7TDAIhd00FJPn_3ePStQlm2w1E5NzFYOTAztixeGoFiQ4o7j0B3AegJH-T8wFLEJ6aw/exec"; 
    const adminWA = "6285353365335"; 

    function previewImage() {
        const file = document.getElementById('foto').files[0];
        const reader = new FileReader();
        reader.onload = (e) => { 
            document.getElementById('image-preview').src = e.target.result;
            document.getElementById('preview-container').style.display = 'block';
        };
        if (file) reader.readAsDataURL(file);
    }

    function resetForm() {
        if(confirm("Hapus semua data?")) {
            document.getElementById('pendaftaranForm').reset();
            document.getElementById('preview-container').style.display = 'none';
        }
    }

    async function kirimData() {
    const btn = document.getElementById('btnSubmit');
    const fileInput = document.getElementById('foto');
    if (!fileInput.files[0]) return alert("Mohon upload foto calon santri!");

    // Menampilkan loading pada tombol
    btn.textContent = 'Sedang Menyimpan Data...';
    btn.disabled = true;

    const file = fileInput.files[0];
    const reader = new FileReader();
    
    reader.onload = async function() {
        const base64Data = reader.result.split(',')[1];
        const formData = {
            nama: document.getElementById('nama').value,
            jk: document.getElementById('jk').value,
            nisn: document.getElementById('nisn').value,
            nik: document.getElementById('nik').value,
            no_kk: document.getElementById('no_kk').value,
            tempat: document.getElementById('tempat').value,
            tgl: document.getElementById('tgl').value,
            sekolah: document.getElementById('sekolah').value,
            alamat: document.getElementById('alamat').value,
            ibu: document.getElementById('ibu').value,
            hp: document.getElementById('hp').value,
            fotoData: base64Data,
            fotoType: file.type,
            fotoName: "Foto_" + document.getElementById('nama').value.replace(/\s+/g, '_')
        };

        try {
            // Menggunakan fetch dengan mode 'no-cors'
            // Mode ini akan selalu menganggap request "selesai" tanpa membaca isi responnya
            fetch(URL_SCRIPT_GOOGLE, { 
                method: 'POST', 
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams(formData) 
            });

            // Memberikan sedikit jeda sebelum membuka WhatsApp agar data sempat terkirim
            setTimeout(() => {
                const pesan = `*PENDAFTARAN SANTRI 2026*\n*Ponpes Miftahul Ulum*\n\nAlhamdulillah, data pendaftaran atas nama *${formData.nama}* telah masuk ke sistem database.\n\nMohon simpan bukti chat ini sebagai tanda bukti pendaftaran.\nSyukron.`;
                
                window.open(`https://wa.me/${adminWA}?text=${encodeURIComponent(pesan)}`, '_blank');
                
                // Membersihkan form setelah berhasil
                document.getElementById('pendaftaranForm').reset();
                document.getElementById('preview-container').style.display = 'none';
                
                alert("Data berhasil dikirim ke database dan WhatsApp Panitia.");
                
                btn.disabled = false; 
                btn.textContent = 'Daftar via WhatsApp';
            }, 1500);

        } catch (e) { 
            console.error(e);
            alert("Terjadi kendala teknis. Pastikan koneksi internet stabil dan ukuran foto tidak terlalu besar."); 
            btn.disabled = false; 
            btn.textContent = 'Daftar via WhatsApp';
        }
    };
    reader.readAsDataURL(file);
}
</script>
</body>
</html>
